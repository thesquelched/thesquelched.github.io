<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Watch Out for Scott]]></title>
  <link href="http://thesquelched.github.io/atom.xml" rel="self"/>
  <link href="http://thesquelched.github.io/"/>
  <updated>2014-07-07T13:34:57-05:00</updated>
  <id>http://thesquelched.github.io/</id>
  <author>
    <name><![CDATA[Scott]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Easier Two-Factor Authentication in FastMail With Pentadactyl]]></title>
    <link href="http://thesquelched.github.io/blog/2014/07/07/easier-two-factor-authentication-in-fastmail-with-pentadactyl/"/>
    <updated>2014-07-07T11:41:59-05:00</updated>
    <id>http://thesquelched.github.io/blog/2014/07/07/easier-two-factor-authentication-in-fastmail-with-pentadactyl</id>
    <content type="html"><![CDATA[<p>I switched to <a href="https://www.fastmail.fm">FastMail</a> last month, and so far it&rsquo;s pretty
great (aside from my bayes spam filter not quite working optimally yet).
One of the selling points was that FastMail supports multiple two-factor
authentication providers, including Google Authenticator, which is a must
security-conscious folk like myself.  However, the login process is somewhat
annoying.  The login page looks like this:</p>

<p><img src="http://i.imgur.com/3x7mUT6.png" alt="FastMail Login Screen" /></p>

<p>In order to use two-factor authentication, you need to click the &ldquo;More&rdquo; link,
which reveals the two-factor auth code input.  This feels unnecessary, and it&rsquo;s
particularly annoying to me, a <a href="http://5digits.org/pentadactyl/">Pentadactyl</a>
user, as I have to either grab the mouse and click on the link, or I have to
exit insert mode, search for the &ldquo;More&rdquo; link, hit enter, and then re-enter
insert mode to input the two-factor code.  Also, unlike Gmail, there&rsquo;s no
option to allow an authenticated computer to skip the two-factor auth step in
the future.</p>

<p>FastMail <a href="https://www.fastmail.fm/help/account/2fa.html">openly admits that the process is a pain</a>,
and that they intend to streamline it at some point in the future, but damnit,
I demand satisfaction <em>now</em>.  While there&rsquo;s nothing I can do about the latter
issue, I sure as hell can take care of the former.  Pentadactyl allows you
<a href="http://5digits.org/help/map.xhtml#:command">create custom Javascript commands</a>,
which you can run automatically using
<a href="http://5digits.org/help/autocommands.xhtml">autocommands</a>.  Using these two
features, I should be able to write a command to locate and click the &ldquo;More&rdquo;
link (which is actually a <code>&lt;span&gt;</code> element), which I can then call
automatically on page load with an autocommand.</p>

<p>Let&rsquo;s try the simplest possible approach: get the DOM element corresponding to the link, then call its <code>click</code> method.  This goes in your <code>$HOME/.pentadactylrc</code> file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>command! fastmail-twofactor -description "Show FastMail two-factor auth window" -javascript
</span><span class='line'>    \ content.document.querySelector('div.content #problem span').click();
</span><span class='line'>
</span><span class='line'>autocmd DOMLoad www.fastmail.fm :fastmail-twofactor</span></code></pre></td></tr></table></div></figure>


<p>Note that, in order to access <code>document</code>, which would ordinarily be a global
variable, you need to use the <code>content</code> object provided by Pentadactyl.  You
can then reload the configuration using the <code>:rehash</code> or <code>:reh</code> command.
However, upon reloading the page, the dialog is still collapsed.  Manually
running the <code>:fastmail-twofactor</code> command works, though, so there must be a
problem with the autocommand.  The <code>DOMLoad</code> event fires when the page loads,
so the command should work as long as the &ldquo;More&rdquo; link is present on load;  one
way this could fail is if some content is added to the page asynchronously
after the DOM loads.  You can confirm this using the Firefox debugger.  It
turns out that <code>homepage.js</code> is loaded on the page; setting a breakpoint at the
beginning and stepping through the execution reveals that the page loads
without the login window, one to load and display it shortly afterward.</p>

<p>Unfortunately, there&rsquo;s no Pentadactyl event for loading individual objects on
the page, so we&rsquo;ll have to look for a pure Javascript solution.  DOM3, which has been supported by major browsers for a while now, provides the
<a href="https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver">MutationObserver object</a>,
which allows you to observe changes in the DOM.  We should be able to use this
to detect when the &ldquo;More&rdquo; link is added, after which we can trigger the click
event.  However, just to be safe, we should check if the link already exists
beforehand.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>command! fastmail-twofactor -description "Show FastMail two-factor auth window" -javascript
</span><span class='line'>    \ var problem = content.document.querySelector('div.content #problem');
</span><span class='line'>    \ 
</span><span class='line'>    \ var more_link = problem.querySelector('span');
</span><span class='line'>    \ if (more_link != null) {
</span><span class='line'>    \   more_link.click();
</span><span class='line'>    \   return;
</span><span class='line'>    \ }
</span><span class='line'>    \
</span><span class='line'>    \ var obs = new MutationObserver(function(mutations) {
</span><span class='line'>    \   mutations.forEach(function(mutation) {
</span><span class='line'>    \     for (var i = 0; i &lt; mutation.addedNodes.length; i++) {
</span><span class='line'>    \       var node = mutation.addedNodes.item(i);
</span><span class='line'>    \       if (node.tagName.toLowerCase() === 'span') {
</span><span class='line'>    \         node.click();
</span><span class='line'>    \         obs.disconnect();
</span><span class='line'>    \       }
</span><span class='line'>    \     };
</span><span class='line'>    \   });
</span><span class='line'>    \ });
</span><span class='line'>    \
</span><span class='line'>    \ obs.observe(problem, {childList: true});
</span><span class='line'>
</span><span class='line'>autocmd DOMLoad www.fastmail.fm :fastmail-twofactor</span></code></pre></td></tr></table></div></figure>


<p>Voila!  The login window now automatically expands when you enter the page.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[New Blog, Sucka]]></title>
    <link href="http://thesquelched.github.io/blog/2014/06/21/new-blog/"/>
    <updated>2014-06-21T13:08:33-05:00</updated>
    <id>http://thesquelched.github.io/blog/2014/06/21/new-blog</id>
    <content type="html"><![CDATA[<p>Administrating your own server (or VPS, as it were) is hard, thankless work, and more than a little pointless, given the alternatives.  Sure, you can roll my own email server, but if you don&rsquo;t want to get bounced by Gmail or whatever, you&rsquo;ve got to worry about DKIM keys, SPF records, etc., and even then, there&rsquo;s no guarantee that Google won&rsquo;t give you the finger, just to be safe.  And even if you get outgoing mail right, you better get spam protection right, or between every chain mail from your mom, you&rsquo;ll 10,000 <em>slightly</em> more annoying emails about Dr. Oz&rsquo;s new diet that makes your penis bigger using bitcoin, or whatever.</p>

<p>Then, there&rsquo;s running your own blog.  I used Wordpress on my VPS, because <strong>of course</strong> I need 45,000 available plugins, a MySQL database, and a huge, neon &ldquo;please hack me&rdquo; sign to make dick jokes.  But hey, at least I had a plugin to show <a href="http://www.last.fm/user/thesquelched">my recent scrobbles</a>, right?  And I only had to pay $14 a month for the pleasure!  (All joking aside, <a href="http://serveraxis.com/vps.php">ServerAxis&rsquo;s metered VPS</a> are great.)</p>

<p>Last week, I was looking at $168/year for my blog (to which I rarely post) and my email (filled to the brim with spam), plus the associated cost in time to maintain each.  Now, I&rsquo;m spending $40/year on a <a href="https://www.fastmail.fm/signup/personal.html">FastMail Enhanced Account</a> with:</p>

<ul>
<li>Baller spam protection</li>
<li>Custom domain</li>
<li>Two-factor authentication</li>
<li>A webmail interface that blows SquirrelMail out of the water</li>
</ul>


<p>Then, as you might gather from the title of this post, I switched to a static <a href="https://pages.github.com/">GitHub blog</a> using <a href="http://octopress.org/">Octopress</a>, which presumably should scale better than a single, low-tier VPS server (not that I&rsquo;ll need that particular feature).  Plus, if I need to roll out another web app, <a href="https://github.com/thesquelched/first_birthday">like the one I built to track invitations for my daughter&rsquo;s first birthday party</a>, there&rsquo;s always Heroku.</p>

<p>That&rsquo;s a savings of $128/year for better products and fewer headaches (or <a href="http://heartbleed.com/">heartaches</a>.  Sounds like a good deal to me.</p>
]]></content>
  </entry>
  
</feed>
